{% set page = 'debug' %}
{% extends "layout.html" %}
{% block title %}Debug{% endblock %}

{% block content %}

<div id="debug_mode_wrapper">
    <div class="switch-wrapper debug-switch">
    <span class="switch-label">Mode Debug :</span>
    {% if debug %}
        <a href="{{ url_for('set_debug_route', on=0) }}" class="">
            <div class="switch on">
                <span class="btn"></span>
                <span class="text">oui</span>
            </div>
        </a>
    {% else %}
        <a href="{{ url_for('set_debug_route', on=1) }}" class="">
            <div class="switch off">
                <span class="text">non</span>
                <span class="btn"></span>
            </div>
        </a>
    {% endif %}
    </div>

    <a class="download" title="Exporter les logs" href="{{ url_for('download_controllino_debug') }}">
        <img src="{{ url_for('static', filename='img/download.png') }}" alt="Exporter les logs" />
    </a>
</div>

<h2>État de la Controllino</h2>

<div id="controllino">
{% for component, state in states.items() %}
    <div>
        <h3>{{ component }}</h3>
    <pre>
{{ state }}
    </pre>
    </div>
{% endfor %}
</div>

<hr class="sep" />

<h2>État de la Raspberry</h2>
<div id="rpi">
    <div id="rpi_disk_usage"></div>
    <div>
        <div id="rpi_cpu_usage"></div>
        <div id="rpi_cpu_temp"></div>
    </div>
    <div id="rpi_memory"></div>
</div>
{% endblock %}

{% block js %}
<script src="{{ url_for('static', filename='js/plotly-latest.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/debug.js') }}"></script>
<script>
plotRPiDisk({{ rpi["disk_usage"].total }}, {{ rpi["disk_usage"].used }})
plotRPiCPU({{ rpi["cpu_percent"] }}, {{ rpi["cpu_temp"] }}, {{ rpi["cpu_freq"].current }})
plotRPiMemory({{ rpi["virtual_memory"].total }}, {{ rpi["virtual_memory"].used }})
</script>
{% endblock %}
